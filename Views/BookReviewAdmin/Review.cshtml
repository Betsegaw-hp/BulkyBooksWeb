@model BulkyBooksWeb.Models.Book
@{
    ViewData["Title"] = "Review Book";
}

<h2>Review Book: @Model.Title</h2>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">@Model.Title</h5>
                <p class="card-text"><strong>Author:</strong> @Model.Author.FullName</p>
                <p class="card-text"><strong>Category:</strong> @Model.Category.Name</p>
                <p class="card-text"><strong>ISBN:</strong> @Model.ISBN</p>
                <p class="card-text"><strong>Price:</strong> $@Model.Price</p>
                <p class="card-text"><strong>Published Date:</strong> @Model.PublishedDate.ToString("d")</p>
                <p class="card-text"><strong>Description:</strong></p>
                <p class="card-text">@Model.Description</p>
                
                @if (!string.IsNullOrEmpty(Model.PdfFilePath))
                {
                    var fileName = System.IO.Path.GetFileName(Model.PdfFilePath);
                    <div class="mt-3">
                        <h6>PDF Document:</h6>
                        <a href="@Url.Action("BookPdf", "File", new { fileName = fileName, inline = true })" target="_blank" class="btn btn-outline-primary">
                            <i class="fas fa-file-pdf"></i> View PDF (inline)
                        </a>
                        <a href="@Url.Action("BookPdf", "File", new { fileName = fileName })" class="btn btn-outline-secondary">
                            <i class="fas fa-download"></i> Download PDF
                        </a>
                    </div>
                }

                <!-- Author KYC Information -->
                <div class="mt-4">
                    <h6>Author KYC Information:</h6>
                    <div class="card border-info">
                        <div class="card-body">
                            <p><strong>KYC Status:</strong> 
                                <span class="badge bg-@(Model.Author.KycStatus switch 
                                {
                                    KycStatus.Pending => "warning",
                                    KycStatus.Verified => "success", 
                                    KycStatus.Rejected => "danger",
                                    _ => "secondary"
                                })">@Model.Author.KycStatus</span>
                            </p>
                            @if (Model.Author.KycVerifiedAt.HasValue)
                            {
                                <p><strong>Verified Date:</strong> @Model.Author.KycVerifiedAt.Value.ToString("g")</p>
                            }
                            @if (!string.IsNullOrEmpty(Model.Author.KycAdminNotes))
                            {
                                <p><strong>KYC Notes:</strong> @Model.Author.KycAdminNotes</p>
                            }
                            
                            <div class="mt-2">
                                <h6>KYC Documents:</h6>
                                <div class="btn-group" role="group">
                                    @if (!string.IsNullOrEmpty(Model.Author.IdProofPath))
                                    {
                                        var idProofFileName = System.IO.Path.GetFileName(Model.Author.IdProofPath);
                                        <a href="@Url.Action("KycDoc", "File", new { fileName = idProofFileName, type = "idproofs", inline = true })" target="_blank" class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-id-card"></i> ID Proof
                                        </a>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.Author.AddressProofPath))
                                    {
                                        var addressProofFileName = System.IO.Path.GetFileName(Model.Author.AddressProofPath);
                                        <a href="@Url.Action("KycDoc", "File", new { fileName = addressProofFileName, type = "addressproofs", inline = true })" target="_blank" class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-home"></i> Address Proof
                                        </a>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.Author.AuthorPhotoPath))
                                    {
                                        var authorPhotoFileName = System.IO.Path.GetFileName(Model.Author.AuthorPhotoPath);
                                        <a href="@Url.Action("KycDoc", "File", new { fileName = authorPhotoFileName, type = "authorphotos", inline = true })" target="_blank" class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-user"></i> Author Photo
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.AdminReviewComments))
                {
                    <div class="alert alert-info mt-3">
                        <strong>Previous Review Comments:</strong>
                        <p>@Model.AdminReviewComments</p>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        @if (!string.IsNullOrEmpty(Model.CoverImagePath))
        {
            <img src="@Model.CoverImagePath" class="img-fluid" alt="Book cover" />
        }
        
        <div class="mt-3">
            <h6>Review Actions</h6>
            <form asp-action="Approve" method="post" class="mb-2">
                <input type="hidden" name="id" value="@Model.Id" />
                <div class="mb-2">
                    <label>Comments (optional):</label>
                    <textarea name="comments" class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-100">
                    <i class="fas fa-check"></i> Approve
                </button>
            </form>
            
            <form asp-action="Reject" method="post">
                <input type="hidden" name="id" value="@Model.Id" />
                <div class="mb-2">
                    <label>Comments (optional):</label>
                    <textarea name="comments" class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-danger w-100">
                    <i class="fas fa-times"></i> Reject
                </button>
            </form>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="@Url.Action("Dashboard")" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>
